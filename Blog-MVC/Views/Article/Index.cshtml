@using Blog_MVC.Classes;
@using Blog_MVC.Models;

@model IEnumerable<Article> 


@{
    ViewBag.Title = "Index";
}
<div class="container">
    <div class="well">

        <h1><b>Всички ст@тии</b></h1>

        <p>
            @Html.ActionLink("Нова статия", "Create",null, new { @class = "btn btn-warning btn-xs" })
        </p>
        <table class="table table-striped table-bordered">
            <tr>
                <th>
                    @Html.ActionLink("Заглавие", "Index", new { @sortOrder = ViewBag.TitleSort } )
                </th>
                <th>
                    @Html.ActionLink("Съдаржание", "Index", new { @sortOrder = ViewBag.BodySort } )
                </th>

                <th>
                    @Html.ActionLink("Дата", "Index", new { @sortOrder = ViewBag.DateSort } )
                </th>
                <th>
                    @Html.ActionLink("Автор", "Index", new { @sortOrder = ViewBag.AuthorSort })
                </th>
                <th>
                    Действия
                </th>
            </tr>

            @foreach (var article in Model)
            {
                <tr>
                    <td>
                        @Html.ActionLink(@article.Title, "Details", "Article", new { @id = article.Id }, null)
                    </td>
                    <td>
                        @Utils.CutText(article.Body)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => article.Date)
                    </td>
                    <td>
                        @if (article.Author != null)
                        {
                            @article.Author.FullName
                        }
                        else
                        {
                            <i>(няма автор)</i>
                        }
                    </td>
                    <td>
                        @if (User.IsInRole("Admin") || article.IsAuthor(User.Identity.Name))
                        {
                            @Html.ActionLink("Редактирай", "Edit", new { id = article.Id }, new { @class = "btn btn-info btn-xs" })
                            
                        }
                        @if (User.IsInRole("Admin"))
                        {
                        @Html.ActionLink("Изтриване", "Delete", new { id = article.Id }, new { @class = "btn btn-danger btn-xs" })
                        }
                        
                        
                        @Html.ActionLink("Чети още", "Details", new { id = article.Id }, new { @class = "btn btn-success btn-xs" })
                        
                        @Html.ActionLink("Коментирай", "Create","Comment", new { id = article.Id }, new { @class = "btn btn-warning btn-xs" })
                    </td>
                </tr>
            }

        </table>
    </div>
</div>
